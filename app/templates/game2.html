<body>
    <div>
        <h2>Question:</h2>
        <p id="question">Waiting for the next question...</p>
        <button id="confirmBtn" style="display:none;">Confirm</button>
    </div>

    <script type="text/javascript">
        function requestUpdate() {
            console.log("DEBUG: requesting update");

            $.getJSON('/_refresh', function(result) {
                console.log("DEBUG: Received data:", result.data);

                if (result.data === undefined) {
                    console.log("DEBUG: Received undefined, stopping updates.");
                    clearInterval(intervalID);
                    alert("Quiz completed!");
                } else {
                    // Display question and show confirm button
                    $("#question").text(result.data);
                    $("#confirmBtn").show();
                }
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.log("DEBUG: Error on GET request:", textStatus, errorThrown);
            });
        }

        function confirmQuestion() {
            const quizId = '{{ quiz_id }}';
            const username = '{{ username }}';

            $.ajax({
                url: `/quiz/${quizId}/${username}/confirm_question`,
                type: 'POST',
                contentType: 'application/json',
                success: function(response) {
                    console.log(response.message);
                    $("#confirmBtn").hide(); // Hide confirm button after confirmation
                },
                error: function(xhr) {
                    console.error("Error confirming question:", xhr);
                }
            });
        }

        $(document).ready(function() {
            console.log("DEBUG: document ready");
            const quizId = '{{ quiz_id }}';
            const username = '{{ username }}';

            // Automatically mark the player as ready when the page loads
            $.ajax({
                url: `/quiz/${quizId}/${username}/mark_ready`,
                type: 'POST',
                contentType: 'application/json',
                success: function(response) {
                    console.log(response.message);
                },
                error: function(xhr) {
                    console.error("Error marking player as ready:", xhr);
                }
            });

            $("#confirmBtn").click(confirmQuestion);

            requestUpdate();
            var intervalID = setInterval(requestUpdate, 5000);
        });
    </script>
</body>
